/* Copyright (C) 2012 NS Solutions Corporation. Licensed under the Apache License, Version 2.0. hifive version 0.0.1 (util,controller,view,ui,api.geo,api.sqldb,api.storage) */
(function(a){function e(a,e,k){var c=Error();a&&(c.code=a);if(a=J[a])e=[a].concat(e),c.message=h.u.str.format.apply(null,e);k&&(c.detail=k);throw c;}function M(a){for(code in a)a.hasOwnProperty(code)&&(J[code]=a[code])}function N(a,e,k){var c=null,m=J[a];m&&(e=[m].concat(e),c=h.u.str.format.apply(null,e));return{code:a,message:c,detail:k}}function w(e){return null==e?e:a.isArray(e)?e:[e]}function O(a){var e=document.createElement("span");e.innerHTML='<a href="'+a+'" />';return e.firstChild.href}function U(e){if("regexp"===
a.type(e))return e;var h="",h=-1!==e.indexOf("*")?a.map(e.split("*"),function(a){return a.replace(/\W/g,"\\$&")}).join(".*"):e;return RegExp("^"+h+"$")}var Y=void 0;if(window.h5){if(window.h5.env&&"0.0.1"===window.h5.env.version)return;Y=window.h5}var h={};window.h5=h;h.coexist=function(){window.h5=Y;return h};h.env={version:"0.0.1"};var J={},ha={controllerInternal:null};(function(){function n(a){switch(a){case "string":return"s";case "number":return"n";case "boolean":return"b";case "String":return"S";
case "Number":return"N";case "Boolean":return"B";case "infinity":return"i";case "-infinity":return"I";case "nan":return"x";case "date":return"d";case "regexp":return"r";case "array":return"a";case "object":return"o";case "null":return"l";case o:return"u";case "undefElem":return"_";case "objElem":return"@"}}var o="undefined",k=11004,c=11005,m=11006,r={11E3:"{0} 第一引数には空文字で無い文字列を指定して下さい。",11001:'名前空間"{0}"には、プロパティ"{1}"が既に存在します。',11002:"Function型のオブジェクトは変換できません。",11003:"シリアライザのバージョンが違います。シリアライズされたバージョン：{0} 現行のバージョン：{1}"};
r[k]="型指定子が不正です。";r[c]="循環参照が含まれています。";r[m]="不正な値が含まれるため、デシリアライズできませんでした。";r[11007]="スクリプトのパスが不正です。空文字以外の文字列、またはその配列を指定して下さい。";r[11008]="{0} オプションの指定が不正です。プレーンオブジェクトで指定してください。";r[11009]="deserialize() 引数の値が不正です。引数には文字列を指定してください。";M(r);var s=[],u={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;","'":"&apos;"},l=function(g){g||e(11E3,"h5.u.obj.ns()");"string"!==a.type(g)&&e(11E3,"h5.u.obj.ns()");for(var g=g.split("."),c=window,f=0,d=g.length;f<d;f++)void 0===c[g[f]]&&(c[g[f]]={}),c=c[g[f]];return c},
r=function(a,c){var f=l(a),d;for(d in c)c.hasOwnProperty(d)&&(f[d]&&e(11001,a,d),f[d]=c[d])};r("h5.u",{loadScript:function(g,c){var f=w(g);(!f||0===f.length)&&e(11007);for(var d=0,q=f.length;d<q;d++)g=f[d],("string"!==typeof g||!a.trim(g))&&e(11007);null!=c&&!a.isPlainObject(c)&&e(11008,"h5.u.loadScript()");var b=c&&!0===c.force,i=f.length;if(!c||!0!==c.async){q=a("head");for(d=0;d<i;d++){var v=O(f[d]);if(b||-1===a.inArray(v,s))q.append('<script type="text/javascript" src="'+v+'"><\/script>'),s.push(v)}}else{var l=
c&&!0===c.parallel,m=[],y=h.async.deferred(),p=document.head||document.getElementsByTagName("head")[0],n=function(d){var c=d;if(i<=c)h.async.when(m).done(function(){y.resolve()});else if(d=O(f[c]),!b&&-1!==a.inArray(d,s))n(++c);else{var g=document.createElement("script");g.type="text/javascript";var e=l?h.async.deferred():null;window.ActiveXObject?g.onreadystatechange=function(){if("complete"==g.readyState||"loaded"==g.readyState)g.onreadystatechange=null,e?e.resolve():n(++c)}:(g.onerror=function(){g.onerror=
null;e?e.resolve():n(++c)},g.onload=function(){g.onload=null;e?e.resolve():n(++c)});g.src=d;p.appendChild(g);s.push(d);e&&(m.push(e.promise()),n(++c))}};setTimeout(function(){n(0)},0);return y.promise()}},createInterceptor:function(a,c){return function(f){var d={},e=a?a.call(this,f,d):f.proceed();f.result=e;if(!c)return e;if(h.async.isPromise(e)){var b=this;e.always(function(){c.call(b,f,d)});return e}c.call(this,f,d);return e}}});r("h5.u.str",{startsWith:function(a,c){return 0===a.lastIndexOf(c,
0)},endsWith:function(a,c){var f=a.length-c.length;return 0<=f&&a.lastIndexOf(c)===f},format:function(a,c){if(null==a)return"";var f=arguments;return a.replace(/\{(\d+)\}/g,function(a,c){var b=f[parseInt(c,10)+1];return typeof b===o?o:b})},escapeHtml:function(c){return"string"!==a.type(c)?c:c.replace(/[&"'<>]/g,function(a){return u[a]})}});r("h5.u.obj",{expose:r,ns:l,serialize:function(g){function l(a){for(var d=0,c=q.length;d<c;d++)if(a===q[d])return!0;return!1}function f(a){for(var d=0,c=q.length;d<
c;d++)a===q[d]&&q.splice(d,1)}function d(b){var i=b,g=a.type(b);"object"===typeof b&&(b instanceof String?g="String":b instanceof Number?g="Number":b instanceof Boolean&&(g="Boolean"));switch(g){case "String":case "string":i=n(g)+i;break;case "Boolean":i=i.valueOf();case "boolean":i=n(g)+(i?1:0);break;case "Number":i=i.valueOf();if(a.isNaN&&a.isNaN(b)||a.isNumeric&&!a.isNumeric(b))i=Infinity===b.valueOf()?n("infinity"):-Infinity===b.valueOf()?n("-infinity"):n("nan");i=n(g)+i;break;case "number":i=
a.isNaN&&a.isNaN(b)||a.isNumeric&&!a.isNumeric(b)?Infinity===b?n("infinity"):-Infinity===b?n("-infinity"):n("nan"):n(g)+i;break;case "regexp":i=n(g)+i.toString();break;case "date":i=n(g)+ +i;break;case "array":l(b)&&e(c);q.push(b);for(var h=[],i=n(g)+"[",g=0,m=b.length;g<m;g++){h[g.toString()]=!0;var y;y=b.hasOwnProperty(g)?"function"===a.type(b[g])?n(o):d(b[g]).replace(/\\/g,"\\\\").replace(/"/g,'\\"'):n("undefElem");i+='"'+y+'"';g!==b.length-1&&(i+=",")}var g="",p;for(p in b)h[p]||"function"!==
a.type(b[p])&&(g+='"'+p+'":"'+d(b[p]).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'",');g&&(i+=(b.length?",":"")+'"'+n("objElem")+"{"+g.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),i=i.replace(/,$/,""),i+='}"');i+="]";f(b);break;case "object":l(b)&&e("循環参照が含まれています。");q.push(b);i=n(g)+"{";for(p in b)b.hasOwnProperty(p)&&"function"!==a.type(b[p])&&(i+='"'+p+'":"'+d(b[p]).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'",');i=i.replace(/,$/,"");i+="}";f(b);break;case "null":case o:i=n(g)}return i}a.isFunction(g)&&
e(11002);var q=[];return"1|"+d(g)},deserialize:function(c){function l(c){function g(a){switch(a){case "s":return"string";case "n":return"number";case "b":return"boolean";case "S":return"String";case "N":return"Number";case "B":return"Boolean";case "i":return"infinity";case "I":return"-infinity";case "x":return"nan";case "d":return"date";case "r":return"regexp";case "a":return"array";case "o":return"object";case "l":return"null";case "u":return o;case "_":return"undefElem";case "@":return"objElem"}}
c.match(/^(.)(.*)/);type=RegExp.$1;f=RegExp.$2?RegExp.$2:"";if(void 0!==type&&""!==type)switch(g(type)){case "String":f=new String(f);break;case "string":break;case "Boolean":"0"===f||"1"===f?f=new Boolean("1"===f):e(m);break;case "boolean":"0"===f||"1"===f?f="1"===f:e(m);break;case "nan":""!==f&&e(m);f=NaN;break;case "infinity":""!==f&&e(m);f=Infinity;break;case "-infinity":""!==f&&e(m);f=-Infinity;break;case "Number":"infinity"===g(f)?f=new Number(Infinity):"-infinity"===g(f)?f=new Number(-Infinity):
"nan"===g(f)?f=new Number(NaN):(f=new Number(f),isNaN(f.valueOf())&&e(m));break;case "number":f=(new Number(f)).valueOf();isNaN(f)&&e(m);break;case "array":var b;try{b=a.parseJSON(f)}catch(i){e(m)}a.isArray(b)||e(m);for(c=0;c<b.length;c++)switch(g(b[c].substring(0,1))){case "undefElem":delete b[c];break;case "objElem":for(var h=l(n("object")+b[c].substring(1)),t=[],c=0,D=b.length-1;c<D;c++)t[c]=b[c];b=t;for(var y in h)b[y]=h[y];break;default:b[c]=l(b[c])}f=b;break;case "object":try{b=a.parseJSON(f)}catch(p){e(m)}a.isPlainObject(b)||
e(m);for(y in b)b[y]=l(b[y]);f=b;break;case "date":f=new Date(parseInt(f,10));break;case "regexp":f.match(/^\/(.*)\/(.*)$/);b=RegExp.$1;y=RegExp.$2;try{f=RegExp(b,y)}catch(r){e(m)}break;case "null":""!==f&&e(m);f=null;break;case o:""!==f&&e(m);f=void 0;break;default:e(k)}return f}"string"!==typeof c&&e(11009);c.match(/^(.)\|(.*)/);c=RegExp.$1;"1"!==c&&e(11003,[c,"1"]);var f=RegExp.$2;return l(f)},isJQueryObject:function(c){return!c||!c.jquery?!1:c.jquery===a().jquery},argsToArray:function(a){return Array.prototype.slice.call(a)},
getByPath:function(a){"string"!==typeof a&&e(11E3,"h5.u.obj.getByPath()");a=a.split(".");"window"===a[0]&&a.unshift();for(var c=window,f=0,d=a.length;f<d&&!(c=c[a[f]],null==c);f++);return c}})})();(function(){var n,o,k,c,m,r,s;function u(a){return a.match(/^error$/i)?n:a.match(/^warn$/i)?o:a.match(/^info$/i)?k:a.match(/^debug$/i)?c:a.match(/^trace$/i)?m:a.match(/^all$/i)?r:a.match(/^none$/i)?s:null}function l(b,c){var d={};if(a.isArray(b)){var g=b.slice(0,3).join(" <- ");0<b.slice(3).length&&(g+=
" ...");d.recent=g;d.all=c.join("\n")}else d.recent=b,d.all=c;return d}function g(a){var b="";a.name?b=a.name:(/^\s*function\s*([\w\-\$]+)?\s*\(/i.test(a.toString()),b=RegExp.$1);return b}function F(b){for(var b=h.u.obj.argsToArray(b),c=[],d=0,g=b.length;d<g;d++)c.push(a.type(b[d]));return c.join(", ")}function f(){}function d(b){("string"!==typeof b||0===a.trim(b).length)&&e(v);this.category=a.trim(b)}var q=10002,b=10003,i=10004,v=10005,t=10007,D=10008,y=10010,p={1E4:'ログターゲットのtypeには、オブジェクト、もしくは"console"のみ指定可能です。',
10001:"outの各要素について、categoryは必須項目です。。"};p[q]='category"{0}"が複数回指定されています。';p[b]='level"{0}"の指定は不正です。Number、もしくはtrace, info, debug, warn, error, noneを指定してください。';p[t]='ログターゲット"{0}"が複数回指定されています。';p[i]='"{0}"という名前のログターゲットはありません。';p[v]="categoryは必須項目です。1文字以上の文字列を指定してください。";p[D]="ログターゲット(targets)の指定は1文字以上の文字列、または配列で指定してください。";p[10009]="ログターゲット(target)の指定はプレーンオブジェクトで指定してください。";p[y]="outの各要素についてcategoryは文字列で指定する必要があります。";M(p);n=50;o=40;k=30;c=20;m=10;r=0;s=-1;var A=null;f.prototype={init:function(){},log:function(a){window.console&&
("string"!==typeof a.args[0]?this._logObj(a):this._logMsg(a))},_logMsg:function(a){var b=a.args,c=null,c=1===b.length?b[0]:h.u.str.format.apply(h.u.str,b),b=this._getLogPrefix(a)+c;a.logger.enableStackTrace&&(b+="  ["+a.stackTrace.recent+"]");a.logger.enableStackTrace&&console.groupCollapsed?console.groupCollapsed(b):this._consoleOut(a.level,b);a.logger.enableStackTrace&&this._consoleOut(a.level,a.stackTrace.all);a.logger.enableStackTrace&&console.groupEnd&&console.groupEnd()},_consoleOut:function(a,
b){var d=!1;a==n&&console.error?(console.error(b),d=!0):a==o&&console.warn?(console.warn(b),d=!0):a==k&&console.info?(console.info(b),d=!0):a==c&&console.debug&&(console.debug(b),d=!0);!d&&console.log&&console.log(b)},_getLogPrefix:function(a){return"["+a.levelString+"]"+a.date.getHours()+":"+a.date.getMinutes()+":"+a.date.getSeconds()+","+a.date.getMilliseconds()+": "},_logObj:function(a){var b=a.args,d=this._getLogPrefix(a);b.unshift(d);a.level==n&&console.error?this._output(console.error,b):a.level==
o&&console.warn?this._output(console.warn,b):a.level==k&&console.info?this._output(console.info,b):a.level==c&&console.debug?this._output(console.debug,b):this._output(console.log,b)},_output:function(a,b){a.apply?a.apply(console,b):a(b)}};d.prototype={enableStackTrace:!1,maxStackSize:10,error:function(a){this._log(n,arguments,this.error)},warn:function(a){this._log(o,arguments,this.warn)},info:function(a){this._log(k,arguments,this.info)},debug:function(a){this._log(c,arguments,this.debug)},trace:function(a){this._log(m,
arguments,this.trace)},_traceFunctionName:function(b){var c=Error(),d=c.stack||c.stacktrace,c={},i=[];if(d)var i=d.replace(/\r\n/,"\n").replace(/at\b|@|Error\b|\t|\[arguments not available\]/ig,"").replace(/(http|https|file):.+[0-9]/g,"").replace(/ +/g," ").split("\n"),f=null,i=a.map(i,function(b){return f=0===b.length?null:""===a.trim(b)?"{anonymous}":a.trim(b)}),c=l(i.slice(3,i.length),i.slice(0,this.maxStackSize));else if(b=b.caller,d=0,b)for(;;){var j=F(b.arguments),e=g(b);e?i.push("{"+e+"}("+
j+")"):b.caller?i.push("{anonymous}("+j+")"):i.push("{root}("+j+")");if(!b.caller||d>=this.maxStackSize){c=l(i,i);break}b=b.caller;d++}else l("{unable to trace}","{unable to trace}");return c},_log:function(a,b,c){var b={level:a,args:h.u.obj.argsToArray(b),stackTrace:this.enableStackTrace?this._traceFunctionName(c):""},d=A.out,i=A.defaultOut,c=null;if(d)for(var d=w(d),j=0,g=d.length;j<g;j++){var e=d[j];if(e.compiledCategory.test(this.category)){c=e;break}}c||(c=i);j=c.compiledLevel;c=c.compiledTargets;
if(!(a<j||0>j))if(b.logger=this,b.date=new Date,b.levelString=this._levelToString(a),c&&0!==c.length){j=0;for(g=c.length;j<g;j++)c[j].log(b)}},_levelToString:function(a){if(a===n)return"ERROR";if(a===o)return"WARN";if(a===k)return"INFO";if(a===c)return"DEBUG";if(a===m)return"TRACE"}};h.u.obj.expose("h5.log",{createLogger:function(a){return new d(a)},configure:function(){function c(j,f,l){var B=null==l;if(!B){var h=f.category;("string"!==typeof h||0===a.trim(h).length)&&e(y);h=a.trim(h);-1!==a.inArray(h,
g)&&e(q,f.category);f.compiledCategory=U(h);g.push(h)}h=null==f.level?u(B?d.level:l.level):"string"===typeof f.level?u(a.trim(f.level)):f.level;"number"!==typeof h&&e(b,f.level);f.compiledLevel=h;var h=[],m=f.targets;if(!B||null!=m){var E=[];null==m||a.isArray(m)||"string"===typeof m&&a.trim(m).length||e(D);for(var m=w(m),n=0,v=m.length;n<v;n++){null==m[n]||"string"===typeof m[n]&&a.trim(m[n]).length||e(D);var p=m[n];if(p){-1!==a.inArray(p,E)&&e(t,p);var o=j[p];o||e(i,p);E.push(p);h.push(o.compiledTarget)}}if(!B&&
(j=l.targets,null!=j)){j=w(j);n=0;for(v=j.length;n<v;n++)p=j[n],-1===a.inArray(p,E)&&(h.push(l.compiledTargets[n]),E.push(p))}}f.compiledTargets=h}var d={level:"NONE",targets:null},g=[];A=a.extend(!0,{},h.settings.log?h.settings.log:{defaultOut:d});var l=A.target;l||(l={},A.target=l);(function(b){a.isPlainObject(b)||e(10009);for(var c in b){var d=b[c];a.type(d.type)!=="object"&&d.type!=="console"&&e(1E4);var j=null,j=d.type==="console"?new f:a.extend(true,{},d.type);j.init&&j.init(d);d.compiledTarget=
j}b.console={type:"console",compiledTarget:new f}})(l);var m=A.defaultOut;m||(m=d,A.defaultOut=m);c(l,m);var j=A.out;if(j)for(var j=w(j),B=0,E=j.length;B<E;B++)c(l,j[B],m)}})})();(function(){function e(c){h.settings.aspects=a.map(w(c),function(a){a.target&&(a.compiledTarget=U(a.target));a.pointCut&&(a.compiledPointCut=U(a.pointCut));return a})}h.u.obj.ns("h5.settings");h.settings={commonFailHandler:null,aspects:null,log:null};var o=h.u.createInterceptor(function(a,e){e.start=new Date;return a.proceed()},
function(a,e){this.log.info('{0} "{1}": {2}ms',this.__name,a.funcName,new Date-e.start)}),k=h.u.createInterceptor(function(a){this.log.info('{0} "{1}"が開始されました。',this.__name,a.funcName);this.log.info(a.args);return a.proceed()},function(a){this.log.info('{0} "{1}"が終了しました。',this.__name,a.funcName)});h.u.obj.expose("h5.core.interceptor",{lapInterceptor:o,logInterceptor:k,errorInterceptor:function(c){var e=null;try{e=c.proceed()}catch(n){h.settings.commonFailHandler&&a.isFunction(h.settings.commonFailHandler)&&
h.settings.commonFailHandler.call(null,n)}return e}});a(window.document).trigger("h5preinit");h.settings.aspects&&e(h.settings.aspects);h.log.configure()})();(function(){h.u.obj.expose("h5.env",{ua:function(e){var h=!!e.match(/iPhone/i),k=!!e.match(/iPad/i),c=h||k,m=!!e.match(/android/i),r=!!e.match(/Windows Phone/i),s=!!e.match(/MSIE/),u=!!e.match(/Firefox/i),l=!!e.match(/Chrome/i)||!!e.match(/CrMo/),g=!m&&!!e.match(/Safari/i)&&!l,F=!!e.match(/Webkit/i),f=!!e.match(/Opera/i),d=m&&!!e.match(/Safari/i)&&
!l,q=!(!h&&!r&&!(d&&e.match(/Mobile/)&&!e.match(/SC-01C/)||m&&l&&e.match(/Mobile/)||e.match(/Fennec/i)||e.match(/Opera Mobi/i))),b=!(!k&&!(d&&!e.match(/Mobile/)||m&&l&&!e.match(/Mobile/)||e.match(/SC-01C/)||e.match(/Fennec/i)||e.match(/Opera Tablet/i))),i=!q&&!b,v=null,t=null,D=function(b,c){return a.trim(e.substring(e.indexOf(b)+b.length,e.indexOf(c))).split("_")},y=function(b,c){var d=a.trim(e.match(!1===c?RegExp(b+"[^;)]*"):RegExp(b+"[^;)]*","i"))).split(" ");return 1===d.length?"":d[d.length-
1]},p=function(b,c){var d=a.trim(e.match(!1===c?RegExp(b+"[^;) ]*"):RegExp(b+"[^;) ]*","i"))).split("/");return 1===d.length?"":d[d.length-1]};if(h)t=D("iPhone OS","like"),v=parseInt(t[0]),t=t.join(".");else if(k)t=D("CPU OS","like"),v=parseInt(t[0]),t=t.join(".");else if(!m||!u)m?(t=y("Android"),v=parseInt(t.split(".")[0])):r&&((t=y("Windows Phone OS"))||(t=y("Windows Phone")),v=parseInt(t.split(".")[0]));s&&f&&(s=!1);var A=D=null;if(c||m&&d)D=v,A=t;else{var z=null;s?z=y("MSIE",!1):l?(z=p("Chrome",
!1))||(z=p("CrMo",!1)):g?z=p("Version"):u?z=p("Firefox"):f&&((z=p("Version"))||(z=p("Opera")),z||(z=y("Opera")));z&&(D=parseInt(z.split(".")[0]),A=z)}return{osVersion:v,osVersionFull:t,browserVersion:D,browserVersionFull:A,isiPhone:h,isiPad:k,isiOS:c,isAndroid:m,isWindowsPhone:r,isIE:s,isFirefox:u,isChrome:l,isSafari:g,isOpera:f,isAndroidDefaultBrowser:d,isSmartPhone:q,isTablet:b,isDesktop:i,isWebkit:F}}(navigator.userAgent)})})();(function(){M({5E3:"h5.async.each() の第1引数は配列のみを扱います。"});h.log.createLogger("h5.async");
var n=a.Deferred,o=function(){var a=n();if(!a.notify&&!a.notifyWith&&!a.progress){var e=!1,k=null,o=null;a.__h5__progressCallbacks=[];a.__h5__progressFilters=[];var u=function(b){var d=this.__h5__progressPipeFilters;if(e){var g=o;if(d&&0<d.length)for(var i=0,f=d.length;i<f;i++)g=d[i].apply(this,w(g));g!==o&&(g=w(g));b.apply(k,g)}a.__h5__progressCallbacks.push(b);a.__h5__progressFilters.push(d);return this};a.progress=u;var l=a.promise;a.promise=function(a){a=l.call(this,a);a.progress=u;return a};
a.notify=function(){e=!0;-1!==arguments.length&&(k=this,o=h.u.obj.argsToArray(arguments));var b=a.__h5__progressCallbacks,d=a.__h5__progressFilters,g=h.u.obj.argsToArray(arguments);if(0<b.length)for(var i=0,f=b.length;i<f;i++){var l=g;if(d[i]&&0<d[i].length)for(var q=0,t=d[i].length;q<t;q++)l=d[i][q].apply(this,w(l));l!==arguments&&(l=w(l));b[i].apply(this,l)}return this};a.notifyWith=function(a,b){e=!0;k=a;o=b;var d=this.__h5__progressCallbacks,c=this.__h5__progressFilters;if(0<d.length)for(var i=
0,g=d.length;i<g;i++){var f=b;if(c[i]&&0<c[i].length)for(var l=0,j=c[i].length;l<j;l++)f=c[i][l].apply(this,w(f));f!==b&&(f=w(f));d[i].apply(a,f)}return this};var g=a.pipe;a.pipe=function(b,d,e){b=g.call(this,b,d);e&&(b.__h5__progressPipeFilters=this.__h5__progressPipeFilters?this.__h5__progressPipeFilters.concat([e]):[e]);b.pipe=a.pipe;b.progress=a.progress;return b}}var F=!1,f=a.fail,d=function(){0<arguments.length&&(F=!0);return f.apply(this,arguments)};a.fail=d;var q=a.always,b=function(){0<arguments.length&&
(F=!0);return q.apply(this,arguments)};a.always=b;var i=function(a,b,d){a&&this.done.apply(this,w(a));b&&this.fail.apply(this,w(b));d&&this.progress.apply(this,w(d));return this};a.then=i;var v=a.reject;a.reject=function(){var a=h.settings.commonFailHandler;!F&&a&&f.call(this,a);return v.apply(this,arguments)};var t=a.rejectWith;a.rejectWith=function(){var a=h.settings.commonFailHandler;!F&&a&&this.fail(a);return t.apply(this,arguments)};var D=a.promise;a.promise=function(a){a=D.call(this,a);a.always=
b;a.then=i;a.fail=d;return a};return a},k=function(a){return!!a&&a.done&&a.fail&&!a.resolve&&!a.reject};h.u.obj.expose("h5.async",{deferred:o,when:function(){var c=arguments;1===c.length&&a.isArray(c[0])&&(c=c[0]);var e=h.async.deferred();a.when.apply(a,c).done(function(){e.resolve.apply(e,arguments)}).fail(function(){e.reject.apply(e,arguments)});return e.promise()},isPromise:k,loop:function(c,h,n){a.isArray(c)||e(5E3);var s=o(),u="number"===a.type(n)?n:20,l=!1,g=0,F=c.length,f,d=null,q=function(){if(g===
F)s.resolve(c);else if(l)s.reject(c);else{var a=h.call(c,g,c[g],d);g++;k(a)?a.done(function(){f()}).fail(function(){l=!0;f()}):f()}},b=function(){setTimeout(function(){var a=g-1;0<g&&s.notify({data:c,index:a,value:c[a]});q()},0)},i=!1;f=function(){i||(0===g%u?b():q())};var v=!1,d={resume:function(){!v&&i&&(i=!1,f())},pause:function(){i=!0},stop:function(){v=!0;s.resolve(c)}};b();return s.promise()}})})();(function(){h.u.obj.expose("h5",{ajax:function(e){var o="string"===typeof arguments[0]?arguments[1]:
arguments[0],o=o&&(o.error||o.fail||o.complete||o.always),k=a.ajax.apply(a,arguments);k.progress||(k.progress=function(){});var c=!1,m=h.settings.commonFailHandler;if(!o&&m){k.fail(function(){c||m.apply(null,arguments)});var r=k.fail;k.fail=function(){c=true;return r.apply(k,arguments)};k.error=k.fail;var s=k.always;k.always=function(){c=true;return s.apply(k,arguments)};k.complete=k.always;k.then=function(a,c,e){a&&k.done.apply(k,w(a));c&&k.fail.apply(k,w(c));e&&k.progress.apply(k,w(e));return k}}return k}})})();
(function(){function n(a){return!this.__controllerContext.executeListeners?void 0:a.proceed()}function o(a,b,d){var j=k(a.__name,b);d&&j.push(n);return c(a[b],b,j)}function k(b,d){var c=[],j=h.settings.aspects;if(!j||0===j.length)return c;for(var j=w(j),e=j.length-1;-1<e;e--){var i=j[e];if(!i.target||i.compiledTarget.test(b)){var g=i.interceptors;if(!i.pointCut||i.compiledPointCut.test(d))if(a.isArray(g))for(i=g.length-1;-1<i;i--)c=c.concat(g[i]);else c.push(g)}}return c}function c(a,b,d){for(var c=
function(a,b,C){return function(){var d=this;return C.call(d,{target:d,func:a,funcName:b,args:arguments,proceed:function(){return a.apply(d,this.args)}})}},j=0,e=d.length;j<e;j++)a=c(a,b,d[j]);return a}function m(a){return!!a.match(/^\{.*\}$/)}function r(a){return!!a.match(/^\[.*\]$/)}function s(b){return a.trim(b.substring(1,b.length-1))}function u(b){return a.trim(b.substring(1,b.length-1))}function l(a){return W(a,"window")||W(a,"document")||W(a,"navigator")?Z(a):a}function g(b){var d=function(b,
C){for(var j in b)if(0<=a.inArray(b,C)||T(j,ba)&&d(b[j],C.concat([b])))return!0;return!1};return d(b,[])}function F(b){var d=function(b,C){for(var j in b)if(0<=a.inArray(b,C)||T(j,ca)&&d(b[j],C.concat([b])))return!0;return!1};return d(b,[])}function f(b,d){var j=b[d];return T(d,ba)&&"rootController"!==d&&"parentController"!==d&&!a.isFunction(j)&&j&&!j.__controllerContext.isRoot}function d(b,d,j){var c=[],e=[],i=function(b){e.push(b);for(var C in b)if(f(b,C)){var g=b[C],l=j?g.__controllerContext[d]:
g[d];l&&c.push(l);-1===a.inArray(g,e)&&i(g)}};i(b);return c}function q(a){var d=function(a){var C=a.__meta,j={};if(C)for(var c in C)!1===C[c].useHandlers&&(j[c]=1);for(c in a)C=a[c],f(a,c)&&(d(C),j[c]||b(C))};d(a)}function b(b){var d=b.__controllerContext.bindMap,c;for(c in d)for(var e in d[c]){var g=b,f=c,l=e,h=g.__controllerContext.bindMap[f][l],B=l,q=r(l);q&&(B=u(l));var E=null;switch(B){case "mousewheel":E=H(g,f,B,h);break;case $:case pa:case da:E=j(g,f,l,h);break;default:E=G(g,f,B,h)}if(a.isArray(E)){g=
0;for(f=E.length;g<f;g++)i(E[g],q)}else i(E,q)}}function i(b,d){d&&(b.eventName="["+b.eventName+"]");var j=b.controller,c=b.selector,e=b.eventName,i=b.handler;j.__controllerContext.unbindMap[c]||(j.__controllerContext.unbindMap[c]={});j.__controllerContext.unbindMap[c][e]=i;var j=b.controller.rootElement,g=b.selector,i=b.eventName,c=b.handler,i=(e=r(i))?u(i):i;if(m(g)){var g=s(g),f=!1;g===qa?(g=j,f=!0):g=l(g);f||e||g===document||g===window?a(g).bind(i,c):a(g).live(i,c)}else e?a(g,j).bind(i,c):a(j).delegate(g,
i,c)}function v(a){var b=function(a){var d=a.__meta,C={};if(d)for(var j in d)!1===d[j].useHandlers&&(C[j]=1);for(j in a)d=a[j],f(a,j)&&(b(d),C[j]||t(d))};b(a)}function t(b){var d=b.rootElement,b=b.__controllerContext.unbindMap,j;for(j in b)for(var c in b[j]){var e=b[j][c],i=r(c),g=i?u(c):c;if(m(j)){var f=s(j),h=!1;f===qa?(f=d,h=!0):f=l(f);var B=f===document||f===window;h||i||B?a(f).unbind(g,e):a(f).die(g,e)}else i?a(j,d).unbind(g,e):a(d).undelegate(j,g,e)}}function D(b,d){b.__controllerContext.executeListeners=
d;var j=[],c=function(b){j.push(b);for(var C in b)if(f(b,C)){var e=b[C];e.__controllerContext.executeListeners=d;-1===a.inArray(e,j)&&c(e)}};c(b)}function y(b){var d=[],j=function(b,C,c){b.rootController=C;b.parentController=c;d.push(b);for(var e in b)f(b,e)&&(c=b[e],-1===a.inArray(c,d)&&j(c,C,b))};j(b,b,null)}function p(a,b){var j=b?"__init":"__ready",c=K();setTimeout(function(){c.resolve()},0);var e=c.promise(),i=function(c){var g=!0,l;for(l in c)f(c,l)&&(g=!1,i(c[l]));var B=function(){var d=null;
c[j]&&(d=c[j]({args:c.__controllerContext.args}));var e=b?z(c):Ma(c);h.async.isPromise(d)?d.done(function(){e()}).fail(function(){a.rootController&&a.rootController.dispose(arguments)}):e()};l=b?A(c):d(c,"readyPromise");b&&g&&l.push(e);h.async.when(l).done(function(){B()}).fail(aa)};i(a)}function A(a){var b=d(a,"initPromise");b.push(a.preinitPromise);return b}function z(a){return function(){if(!S(a)){a.isInit=!0;var b=a.__controllerContext.initDfd;delete a.__controllerContext.templatePromise;delete a.__controllerContext.initDfd;
b.resolve();a.__controllerContext&&a.__controllerContext.isRoot&&Na(a)}}}function Ma(b){return function(){if(!S(b)){b.isReady=!0;var d=b.__controllerContext.readyDfd;delete b.__controllerContext.readyDfd;d.resolve();b.__controllerContext&&b.__controllerContext.isRoot&&b.rootElement&&b.isInit&&b.isReady&&a(b.rootElement).trigger("h5controllerready",[b])}}}function I(b,d,c){if("string"!==typeof b)return a(b);var j=a.trim(b);m(j)?(b=s(j),c&&(W(b,"window")||W(b,"navigator"))&&e(ra),c=a(l(b))):c=a(d).find(b);
return c}function G(a,b,d,c){return{controller:a,selector:b,eventName:d,handler:function(){c.call(a,E(a,arguments))}}}function H(a,b,d,c){return{controller:a,selector:b,eventName:typeof document.onmousewheel===sa?"DOMMouseScroll":d,handler:function(){var b=E(a,arguments),d=b.event;d.originalEvent&&d.originalEvent.detail&&(d.wheelDelta=40*-d.detail);c.call(a,b)}}}function j(b,d,c,j){var e=typeof document.ontouchstart!==sa;if(c!==$)return e?G(b,d,c,j):G(b,d,c,function(b){var d=b.event,c=a(d.currentTarget).offset()||
{left:0,top:0};d.offsetX=d.pageX-c.left;d.offsetY=d.pageY-c.top;j.apply(this,arguments)});var i=function(a,b){for(var d in a)a.hasOwnProperty(d)&&!b[d]&&"target"!==d&&"currentTarget"!==d&&"originalEvent"!==d&&"liveFired"!==d&&(b[d]=a[d]);b.h5DelegatingEvent=a},g=e?"touchstart":"mousedown",f=e?"touchmove":"mousemove",l=e?"touchend":"mouseup",h=a(document);return function(){var q=null,t=!1,m=function(d,c,j){return function(g){var P;a:{switch(d){case "touchstart":case "mousedown":P=$;break a;case "touchmove":case "mousemove":P=
pa;break a;case "touchend":case "mouseup":P=da;break a}P=void 0}var Q=P===$;if(!Q||!t){var v=E(b,arguments),k=v.event;e&&B(k,d);var o=new a.Event(P);i(k,o);k=k.target;c&&(k=c);j&&j(o);if(!e||t||Q)a(k).trigger(o,v.evArg),t=!0;if(Q&&t){o.h5DelegatingEvent.preventDefault();var Q=o.target,oa=o.clientX,n=o.clientY,p=m(f,Q,function(a){var b=a.clientX,d=a.clientY;a.dx=b-oa;a.dy=d-n;oa=b;n=d}),V=m(l,Q),D=e?a(Q):h;q=function(){D.unbind(f,p);D.unbind(l,V)};D.bind(f,p);D.bind(l,V)}P===da&&(q(),t=!1)}}},v=[G(b,
d,c,j)];v.push({controller:b,selector:d,eventName:g,handler:m(g)});return v}()}function B(b,d){var c=b.originalEvent,j="touchend"===d||"touchcancel"===d?c.changedTouches[0]:c.touches[0],e=j.pageX,g=j.pageY;b.pageX=c.pageX=e;b.pageY=c.pageY=g;b.screenX=c.screenX=j.screenX;b.screenY=c.screenY=j.screenY;b.clientX=c.clientX=j.clientX;b.clientY=c.clientY=j.clientY;j=b.target;if(j.ownerSVGElement)j=j.farthestViewportElement;else if(j===window||j===document)j=document.body;if(j=a(j).offset())g-=j.top,b.offsetX=
c.offsetX=e-j.left,b.offsetY=c.offsetY=g}function E(b,d){var c=null,j=null;d&&(c=d[0],j=d[1]);var e=c;if(e&&null==e.offsetX&&null==e.offsetY&&e.pageX&&e.pageY){var g=e.target;if(g.ownerSVGElement)g=g.farthestViewportElement;else if(g===window||g===document)g=document.body;if(g=a(g).offset())e.offsetX=e.pageX-g.left,e.offsetY=e.pageY-g.top}return{controller:b,rootElement:b.rootElement,event:c,evArg:j}}function V(a){for(var b in a){var d=a[b];f(a,b)&&(d.rootElement=null,d.view.__controller=null,V(d))}}
function ia(a){var b=a.rootElement,d=a.__meta,c;for(c in a){var j=a[c];f(a,c)&&(j.rootElement=d&&d[c]&&d[c].rootElement?ja(d[c].rootElement,b,j):b,j.view.__controller=j,ia(j))}}function ja(b,d,c){b?(!c||!c.__controllerContext)&&e(ta):e(ua);b=d?I(b,d):a(b);0===b.length&&e(ea,[c.__name]);1<b.length&&e(fa,[c.__name]);return b.get(0)}function Na(c){b(c);q(c);var j=c.__controllerContext.managed,e=h.core.controllerManager.controllers;-1===a.inArray(c,e)&&!1!==j&&e.push(c);!1!==j&&a(c.rootElement).trigger("h5controllerbound",
[c]);j=d(c,"initPromise");j.push(c.initPromise);h.async.when(j).done(function(){p(c,!1)}).fail(aa)}function ka(a){null===a.rootController&&y(a);ia(a);p(a,!0)}function la(a,b){var d=K();d.resolve();a.__controllerContext.templatePromise=d.promise();a.__controllerContext.initDfd=K();a.initPromise=a.__controllerContext.initDfd.promise();a.__controllerContext.readyDfd=K();a.readyPromise=a.__controllerContext.readyDfd.promise();a.isInit=!1;a.isReady=!1;a.__controllerContext.args=b;for(var c in a)f(a,c)&&
la(a[c])}function ma(b,d){var c=null,j=d;a.isPlainObject(j)?c=j.target:j={};c=c?I(c,b.rootElement,!0):b.rootElement;return h.ui.indicator.call(b,c,j)}function na(b,d){var c=[],j=[],e=function(b){j.push(b);for(var g in b)if(f(b,g)){var i=b[g];-1===a.inArray(i,j)&&e(i)}b[d]&&a.isFunction(b[d])&&c.push(b[d]())};e(b);return c}function Oa(b){var d=[],c=function(b){d.push(b);Z("h5.core.view")&&b.view.clear();for(var j in b)if(b.hasOwnProperty(j)){if(f(b,j)){var e=b[j];-1===a.inArray(e,d)&&c(e)}b[j]=null}};
c(b)}function R(a,b){return b.view.__view.isAvailable(a)?b.view.__view:b.parentController?R(a,b.parentController):h.core.view}function S(a){return!a.__controllerContext||a.__controllerContext.isDisposing}function N(a,b){function d(a,j){var g=a.__controllerContext[e[j]];g&&!g.isRejected()&&!g.isResolved()&&g.reject(b);if(a.parentController)d(a.parentController,j);else if(j<e.length-1)for(var g=0,i=c.length;g<i;g++)d(c[g],j+1)}var c=[],j=function(a){var b=!1,d;for(d in a)f(a,d)&&(b=!0,j(a[d]));b||c.push(a)};
j(a);for(var e=["initDfd","readyDfd"],g=0,i=c.length;g<i;g++)d(c[g],0)}function va(a){this.__controller=a;Z("h5.core.view")&&(this.__view=h.core.view.createView())}function X(b,d,c,j){this.__name=d;this.__templates=null;this.rootElement=b;this.__controllerContext={executeListeners:!0,isRoot:j,bindMap:{},unbindMap:{}};c&&(this.__controllerContext.args=a.extend(!0,{},c));this.isReady=this.isInit=!1;this.readyPromise=this.initPromise=this.parentController=this.rootController=null;this.log=h.log.createLogger(d);
this.view=new va(this)}function wa(){this.rootElement=document;this.controllers=[];a(document).bind("triggerIndicator",function(a,b){null==b.target&&(b.target=document);b.indicator=ma(this,b);a.stopPropagation()})}function J(b,d,c,j){var i=d.__name;(!i||0===a.trim(i).length)&&e(xa,null,{controllerDefObj:d});c&&!a.isPlainObject(c)&&e(ya,[i],{controllerDefObj:d});d.__controllerContext&&e(za,null,{controllerDefObj:d});if(b){var f=a(b);0===f.length&&e(ea,[i],{controllerDefObj:d});1<f.length&&e(fa,[i],
{controllerDefObj:d})}g(d)&&e(Aa,[i],{controllerDefObj:d});F(d)&&e(Ba,[i],{controllerDefObj:d});var l=!j||!j.isInternal,f=a.extend(!0,{},d),h=new X(b?a(b).get(0):null,i,c,l),B=d.__templates,q=K(),b=q.promise(),E=K(),t=E.promise();h.__controllerContext.preinitDfd=E;h.preinitPromise=t;h.__controllerContext.initDfd=K();h.initPromise=h.__controllerContext.initDfd.promise().fail(aa);h.__controllerContext.readyDfd=K();h.readyPromise=h.__controllerContext.readyDfd.promise();l||h.readyPromise.fail(aa);if(B&&
0<B.length){var v=function(a){Z("h5.core.view")||e(Ca);h.view.load(B).then(function(){q.resolve()},function(b){var c=b.detail.error,c=c?c.status:null;a===U||0!==c&&12029!==c?(b.controllerDefObject=d,setTimeout(function(){q.reject(b)},0)):setTimeout(function(){v(++a)},Y)})};v(0)}else q.resolve();b.done(function(){S(h)||E.resolve()}).fail(function(a){E.reject(a);h.rootController&&S(h.rootController);h.rootController&&h.rootController.dispose(a)});for(var k in f)if(ga[k])e(Da,[i,k],{controllerDefObj:d});
else if(("__ready"===k||"__construct"===k||"__init"===k)&&a.isFunction(f[k]))h[k]=o(f,k);else if(-1!==k.indexOf(" ")&&a.isFunction(f[k])){b=a.trim(k).lastIndexOf(" ");l=a.trim(k.substring(0,b));b=a.trim(k.substring(b+1,k.length));r(b)&&(b="["+a.trim(u(b))+"]");m(l)&&"this"===s(l)&&e(Ea,[i],{controllerDefObj:d});t=h.__controllerContext.bindMap;t[l]||(t[l]={});t[l][b]&&e(Fa,[i,l,b],{controllerDefObj:d});var n=o(f,k,!0);t[l][b]=n;h[k]=n}else T(k,ba)&&f[k]&&!a.isFunction(f[k])?(l=J(null,a.extend(!0,{},
f[k]),c,a.extend({isInternal:!0},j)),h[k]=l):T(k,ca)&&f[k]&&!a.isFunction(f[k])?(l=O(f[k]),h[k]=l):h[k]=a.isFunction(f[k])?o(f,k):f[k];if(c=h.__meta)for(k in c)l=h[k],void 0===l&&e(Ga,[i,k],{controllerDefObj:d}),null===l&&e(Ha,[i,k],{controllerDefObj:d}),X.prototype.constructor!==l.constructor&&e(Ia,[i,k],{controllerDefObj:d});h.__construct&&h.__construct({args:h.__controllerContext.args});if(S(h))return null;j&&"managed"in j&&(h.__controllerContext.managed=j.managed);h.__controllerContext.isRoot&&
ka(h);return h}function O(b){var d=b.__name;(!d||0===a.trim(d.length))&&e(Ja,null,{logicDefObj:b});b.__logicContext&&e(Ka,null,{logicDefObj:b});var b=a.extend(!0,{},b),j;for(j in b)b[j]=a.isFunction(b[j])?c(b[j],j,k(b.__name,j)):b[j];b.deferred=K;b.log=h.log.createLogger(d);b.__logicContext={};for(var g in b)b.hasOwnProperty(g)&&T(g,ca)&&(b[g]=O(b[g]));return b}var U=3,Y=3E3,sa="undefined",ba="Controller",ca="Logic",$="h5trackstart",pa="h5trackmove",da="h5trackend",qa="rootElement",ra=6E3,ua=6001,
ta=6002,ea=6003,fa=6004,xa=6006,ya=6007,za=6008,Aa=6009,Ba=6010,Da=6011,Ea=6012,Fa=6013,Ga=6014,Ha=6015,Ia=6016,Ja=6017,Ka=6018,Ca=6029,x={};x[ra]='update/append/prepend() の第1引数に"window", "navigator", または"window.", "navigator."で始まるセレクタは指定できません。';x[ua]="バインド対象となる要素を指定して下さい。";x[ta]="コントローラ化したオブジェクトを指定して下さい。";x[ea]='コントローラ"{0}"のバインド対象となる要素が存在しません。';x[fa]='コントローラ"{0}"のバインド対象となる要素が2つ以上存在します。バインド対象は1つのみにしてください。';x[6005]="正しい数の引数を指定して下さい。";x[xa]="コントローラの名前が定義されていません。__nameにコントローラ名を設定して下さい。";x[ya]='コントローラ"{0}"の初期化パラメータがプレーンオブジェクトではありません。初期化パラメータにはプレーンオブジェクトを設定してください。';
x[za]="指定されたオブジェクトは既にコントローラ化されています。";x[Aa]='コントローラ"{0}"で、参照が循環しているため、コントローラを生成できません。';x[Ba]='コントローラ"{0}"のロジックで、参照が循環しているため、ロジックを生成できません。';x[Da]='コントローラ"{0}"のプロパティ"{1}"はコントローラ化によって追加されるプロパティと名前が重複しています。';x[Ea]='コントローラ"{0}"でセレクタ名にthisが指定されています。コントローラをバインドした要素自身を指定したい時はrootElementを指定してください。';x[Fa]='コントローラ"{0}"のセレクタ"{1}"に対して"{2}"というイベントハンドラが重複して設定されています。';x[Ga]='コントローラ"{0}"には__metaで指定されたプロパティ"{1}"がありません。';x[Ha]='コントローラ"{0}"の__metaに指定されたキー"{1}"の値がnullです。コントローラを持つプロパティキー名を指定してください。';x[Ia]='コントローラ"{0}"の__metaに指定されたキー"{1}"の値はコントローラではありません。コントローラを持つプロパティキー名を指定してください。';
x[Ja]="ロジック名が定義されていません。__nameにロジック名を設定して下さい。";x[Ka]="指定されたオブジェクトは既にロジック化されています。";x[6019]="コントローラ、もしくはロジックの __name が設定されていません。";x[Ca]="テンプレートはViewモジュールがなければ使用できません。";M(x);var aa=function(){},K=h.async.deferred,W=h.u.str.startsWith,T=h.u.str.endsWith,Pa=h.u.str.format,La=h.u.obj.argsToArray,Z=h.u.obj.getByPath;a.extend(va.prototype,{get:function(b,a){return R(b,this.__controller).get(b,a)},update:function(b,a,d){b=I(b,this.__controller.rootElement,!0);R(a,this.__controller).update(b,a,d)},append:function(b,
a,d){b=I(b,this.__controller.rootElement,!0);R(a,this.__controller).append(b,a,d)},prepend:function(b,a,d){b=I(b,this.__controller.rootElement,!0);R(a,this.__controller).prepend(b,a,d)},load:function(b){return this.__view.load(b)},register:function(b,a){this.__view.register(b,a)},isValid:function(b){return this.__view.isValid(b)},isAvailable:function(b){return R(b,this.__controller).isAvailable(b)},clear:function(b){this.__view.clear(b)}});a.extend(X.prototype,{$find:function(b){return a(this.rootElement).find(b)},
deferred:function(){return K()},trigger:function(b,d){a(this.rootElement).trigger(b,[d])},own:function(b){var a=this;return function(){b.apply(a,arguments)}},ownWithOrg:function(b){var a=this;return function(){var d=h.u.obj.argsToArray(arguments);d.unshift(this);b.apply(a,d)}},bind:function(b,d){this.rootElement=ja(b,null,this);this.view.__controller=this;var c=null;d&&(c=a.extend(!0,{},d));la(this,c);ka(this);return this},unbind:function(){na(this,"__unbind");t(this);v(this);this.__controllerContext.unbindMap=
{};var b=this.rootElement;h.core.controllerManager.controllers=a.grep(h.core.controllerManager.controllers,function(a){return a.rootElement!==b});a(this.rootElement).trigger("h5controllerunbound");this.rootElement=null;this.view.__controller=null;V(this)},dispose:function(b){if(!S(this)){N(this,b);this.__controllerContext.isDisposing=1;var a=this.deferred();this.unbind();var d=this,b=na(this,"__dispose");h.async.when(b).always(function(){Oa(d);a.resolve()});return a.promise()}},triggerIndicator:function(b,
d){var c=a.extend(!0,{},b),j=d;if(!j||0===j.length)j="triggerIndicator";a(this.rootElement).trigger(j,[c]);return c.indicator},indicator:function(b){return ma(this,b)},enableListeners:function(){D(this,!0)},disableListeners:function(){D(this,!1)},throwError:function(b,a){var d=La(arguments);d.unshift(null);this.throwCustomError.apply(null,d)},throwCustomError:function(b,a,d){2>arguments.length&&e(6005);a&&"string"===typeof a?error=Error(Pa.apply(null,La(arguments).slice(1))):(error=Error(),error.detail=
a);error.customType=b;throw error;}});a.extend(wa.prototype,{getAllControllers:function(){return this.controllers},getController:function(b){for(var b=a(b).get(0),d=this.controllers,c=0,j=d.length;c<j;c++)if(b===d[c].rootElement)return d[c]}});h.u.obj.expose("h5.core",{controllerManager:new wa});var ga={},x=new X(null,"a"),L;for(L in x)x.hasOwnProperty(L)&&"__name"!==L&&"__templates"!==L&&"__meta"!==L&&(ga[L]=1);x=X.prototype;for(L in x)x.hasOwnProperty(L)&&(ga[L]=1);ha.controllerInternal=J;h.u.obj.expose("h5.core",
{controller:function(b,a,d){return J(b,a,d)},logic:O,expose:function(b){var a=b.__name;a||e(6019,null,{target:b});var d=a.lastIndexOf(".");if(-1===d)window[a]=b;else{var c=a.substr(0,d),a=a.substr(d+1,a.length),d={};d[a]=b;h.u.obj.expose(c,d)}}})})();(function(){function n(b){return h.u.obj.isJQueryObject(b)?b:a(b)}function o(){this.__cachedTemplates={}}var k=7E3,c=7001,m=7002,r=7003,s={};s[k]="テンプレートをコンパイルできませんでした。{0}";s[c]="テンプレートファイルが不正です。{0}";s[m]="テンプレートIDが指定されていません。空や空白でない文字列で指定してください。";s[r]=
"テンプレートファイルを取得できませんでした。ステータスコード:{0}, URL:{1}";s[7004]="テンプレートファイルの指定が不正です。空や空白でない文字列、または文字列の配列で指定してください。";s[7005]="テンプレートID:{0} テンプレートがありません。";s[7006]="{0} テンプレートにパラメータが設定されていません。";M(s);var u="scriptタグが見つかりません。テンプレート文字列はscriptタグで囲って記述して下さい。",l="構文エラー {0}{1}",g="[";h.log.createLogger("h5.core.view");var F=h.async.deferred,f={escapeHtml:function(b){return h.u.str.escapeHtml(b)}},d={MAX_CACHE:10,cache:{},cacheUrls:[],accessingUrls:{},append:function(b,a,d){this.cacheUrls.length>=this.MAX_CACHE&&this.deleteCache(this.cacheUrls[0]);
this.cache[b]={};this.cache[b].templates=a;this.cache[b].path=d;this.cacheUrls.push(b)},deleteCache:function(b,a){a||delete this.cache[b];for(var d=0,c=this.cacheUrls.length;d<c;d++)if(this.cacheUrls[d]===b){this.cacheUrls.splice(d,1);break}},getTemplateByUrls:function(b){function d(b){if(0!==b.length){var c={},i=[];b.each(function(){var b=a.trim(this.id),d=a.trim(this.innerHTML);b||e(m,null,{});try{var j=new EJS.Compiler(d,g);j.compile();c[b]=j.process;i.push(b)}catch(f){d=f.lineNumber,e(k,[h.u.str.format(l,
d?" line:"+d:"",f.message)],{id:b,error:f,lineNo:d})}});return{compiled:c,data:{ids:i}}}}function f(b,e,g){h.ajax(e).done(function(e,f,l){delete p.accessingUrls[b];e=a(l.responseText).filter(function(){return this.tagName&&-1===this.tagName.indexOf("/")&&8!==this.nodeType});f=this.url;if(0<e.not('script[type="text/ejs"]').length)g.reject(N(c,[u],{url:b,path:f}));else{l=null;try{l=d(e.filter('script[type="text/ejs"]'))}catch(h){h.detail.url=b;h.detail.path=f;g.reject(h);return}var B,k;try{var q=l.compiled;
k=l.data;k.path=f;k.absoluteUrl=b;B=q;p.append(b,q,f)}catch(t){g.reject(N(c,null,{error:t,url:b,path:f}));return}g.resolve({ret:B,data:k})}}).fail(function(a){delete p.accessingUrls[b];g.reject(N(r,[a.status,b],{url:b,path:e,error:a}))})}for(var q={},o=[],n=[],p=this,s=function(b){var a=p.cache[b].templates;p.deleteCache(b,!0);p.cacheUrls.push(b);return a},z=0;z<b.length;z++){var w=b[z],I=O(w);if(this.cache[I])a.extend(q,s(I)),n.push({absoluteUrl:I});else if(this.accessingUrls[I])o.push(this.accessingUrls[I]);
else{var G=h.async.deferred();o.push(this.accessingUrls[I]=G.promise());f(I,w,G)}}var H=F();h.async.when(o).done(function(){for(var b=h.u.obj.argsToArray(arguments),d=0,c=b.length;d<c;d++)a.extend(q,b[d].ret),n.push(b[d].data);H.resolve(q,n)}).fail(function(b){H.reject(b)});return H.promise()}};a.extend(o.prototype,{load:function(b){var c=F(),g=this,f=null;switch(a.type(b)){case "string":a.trim(b)||e(7004);f=[b];break;case "array":f=b;0===f.length&&e(7004);for(var b=0,l=f.length;b<l;b++)"string"!==
typeof f[b]?e(7004):a.trim(f[b])||e(7004);break;default:e(7004)}d.getTemplateByUrls(f).done(function(b,d){a.extend(g.__cachedTemplates,b);c.resolve(d)}).fail(function(b){c.reject(b)});return c.promise()},getAvailableTemplates:function(){var b=[],a;for(a in this.__cachedTemplates)b.push(a);return b},register:function(b,d){"string"!==a.type(d)?e(k,["テンプレートには文字列を指定してください"],{id:b}):("string"!==typeof b||!a.trim(b))&&e(m,[]);try{var c=new EJS.Compiler(d,g);c.compile();this.__cachedTemplates[b]=c.process}catch(f){c=
f.lineNumber,e(k,[h.u.str.format(l,c?" line:"+c:"",f.message)],{id:b})}},isValid:function(b){try{return(new EJS.Compiler(b,g)).compile(),!0}catch(a){return!1}},get:function(b,d){var c=this.__cachedTemplates;if(a.isEmptyObject(c))return null;("string"!==typeof b||!a.trim(b))&&e(m);(c=c[b])||e(7005,b);var g=d?a.extend(!0,{},d):{},l=g.hasOwnProperty("_h")?new EJS.Helpers(g):new EJS.Helpers(g,{_h:f}),h=null;try{h=c.call(g,g,l)}catch(k){e(7006,k.toString(),k)}return h},update:function(b,a,d){return n(b).html(this.get(a,
d))},append:function(b,a,d){return n(b).append(this.get(a,d))},prepend:function(b,a,d){return n(b).prepend(this.get(a,d))},isAvailable:function(b){return!!this.__cachedTemplates[b]},clear:function(b){if(void 0===b)this.__cachedTemplates={};else{var d=null;switch(a.type(b)){case "string":d=[b];break;case "array":b.length||e(m);d=b;break;default:e(m)}for(var b=0,c=d.length;b<c;b++){var g=d[b];("string"!==typeof g||!a.trim(g))&&e(m)}b=0;for(c=d.length;b<c;b++)delete this.__cachedTemplates[d[b]]}}});
var q=new o;q.createView=function(){return new o};a(function(){a('script[type="text/ejs"]').each(function(){var b=a.trim(this.id),d=a.trim(this.innerHTML);0!==d.length&&b&&(d=new EJS.Compiler(d,g),d.compile(),q.__cachedTemplates[b]=d.process)})});h.u.obj.expose("h5.core",{view:q})})();(function(){function e(d){var c={},b;for(b in l){var g=a("<div></div>").addClass(d).addClass(b).appendTo("body"),f=a.camelCase(b);c[f]={};a.map(l[b],function(b){c[f][b]="width"===b||"height"===b?parseInt(g.css(b).replace(/\D/g,
""),10):g.css(b)});g.remove()}return c}function o(a,c){var b=window.document.createElement("v:"+a),e;for(e in c)b.style[e]=c[e];return b}function k(a,c){for(var b=[],e=a/2,g=0.8*a/2,f=360/c*Math.PI/180,l=1;l<=c;l++){var h=f*l,k=Math.cos(h),h=Math.sin(h);b.push({from:{x:e+g/2*k,y:e+g/2*h},to:{x:e+g*k,y:e+g*h}})}return b}function c(d){this.style=a.extend(!0,{},d);d=this.style.throbber.width;this.group=o("group",{width:d+"px",height:this.style.throbber.height+"px"});this.group.className=r;for(var d=
k(d,this.style.throbber.lines),c=this.style.throbberLine.color,b=this.style.throbberLine.width,e=0,g=d.length;e<g;e++){var f=d[e],l=f.from,h=f.to,f=o("line");f.strokeweight=b;f.strokecolor=c;f.fillcolor=c;f.from=l.x+","+l.y;f.to=h.x+","+h.y;l=o("stroke");l.opacity=1;f.appendChild(l);this.group.appendChild(f)}this._createPercentArea()}function m(d,l){a.blockUI.defaults.css={};a.blockUI.defaults.overlayCSS={};this.target=h.u.obj.isJQueryObject(d)?d.get(0):d;var b=this,i=this._isGlobalBlockTarget()?
a("body"):a(this.target),k=i.css("position"),o=i.css("zoom"),m=a.extend(!0,{},{message:"",percent:-1,block:!0,promises:null,theme:"a"},l),r={message:h.u.str.format(s,""===m.message?'style="display: none;"':"",m.message),css:{},overlayCSS:{},blockMsgClass:m.theme,showOverlay:m.block,centerX:!1,centerY:!1,onUnblock:function(){i.css("position",k);i.css("zoom",o);b.throbber.hide()}},p={throbber:{roundTime:1E3,lines:12},throbberLine:{},percent:{}},A=m.promises,z=a.proxy(function(){this.hide()},this);a.isArray(A)?
(a.map(A,function(b){return u(b)?b:null}),0<A.length&&h.async.when(A).pipe(z,z)):u(A)&&A.pipe(z,z);A=e(m.theme);p=a.extend(!0,p,A);this._style=a.extend(!0,{},r,p);g?this.throbber=new f(this._style):F&&(this.throbber=new c(this._style));this.throbber&&-1<m.percent&&this.throbber.setPercent(m.percent)}var r="vml-root",s='<span class="indicator-throbber"></span><span class="indicator-message" {0}>{1}</span>',u=h.async.isPromise,l={throbber:["width","height"],"throbber-line":["width","color"]},g=!0,F=
h.env.ua.isIE;a(function(){g=!!document.createElement("canvas").getContext;!g&&F&&(document.namespaces.add("v","urn:schemas-microsoft-com:vml"),document.createStyleSheet().cssText="v\\:stroke,v\\:line,v\\:textbox{behavior: url(#default#VML);}")});c.prototype={show:function(a){a&&(this.root=a,this.highlightPos=1,this.hide(),this.root.appendChild(this.group),this._run())},hide:function(){this.root.innerHTML="";this._runId&&(clearTimeout(this._runId),this._runId=null)},_run:function(){for(var a=this.style.throbber.lines,
c=this.style.throbber.roundTime,b=this.highlightPos,e=this.group.childNodes,g=0,f=e.length;g<f;g++){var l=e[g];if("textbox"!==l.nodeName){var h=g+1;l.firstChild.opacity=h==b?"1":h==b+1||h==b-1?"0.75":"0.4"}}b==a?b=0:b++;this.highlightPos=b;var k=this;this._runId=setTimeout(function(){k._run.call(k)},Math.floor(c/a))},_createPercentArea:function(){var d=o("textbox"),c=a("<table><tr><td></td></tr></table>"),b=c.find("td");b.width(this.group.style.width);b.height(this.group.style.height);b.css("line-height",
this.group.style.height);b.addClass("throbber-percent");d.appendChild(c[0]);this.group.appendChild(d)},setPercent:function(d){a(this.group).find(".throbber-percent").html(d)}};var f=function(d){this.style=a.extend(!0,{},d);this.canvas=document.createElement("canvas");this.baseDiv=document.createElement("div");this.percentDiv=document.createElement("div");var d=this.canvas,c=this.baseDiv,b=this.percentDiv;d.width=this.style.throbber.width;d.height=this.style.throbber.height;d.style.display="block";
d.style.position="absolute";c.style.width=this.style.throbber.width+"px";c.style.height=this.style.throbber.height+"px";c.appendChild(d);b.style.width=this.style.throbber.width+"px";b.style.height=this.style.throbber.height+"px";b.style.lineHeight=this.style.throbber.height+"px";b.className="throbber-percent";c.appendChild(b);this.positions=k(d.width,this.style.throbber.lines)};f.prototype={show:function(a){a&&(this.root=a,this.highlightPos=1,this.hide(),this.root.appendChild(this.baseDiv),this._run())},
hide:function(){a(this.baseDiv).remove();this._runId&&(clearTimeout(this._runId),this._runId=null)},_run:function(){var a=this.canvas,c=a.getContext("2d"),b=this.highlightPos,e=this.positions,g=this.style.throbberLine.color,f=this.style.throbberLine.width,l=this.style.throbber.lines,h=this.style.throbber.roundTime;a.width=a.width;for(var a=0,k=e.length;a<k;a++){c.beginPath();c.strokeStyle=g;c.lineWidth=f;var m=a+1;c.globalAlpha=m==b?1:m==b+1||m==b-1?0.75:0.4;var o=e[a],m=o.from,o=o.to;c.moveTo(m.x,
m.y);c.lineTo(o.x,o.y);c.stroke()}b==l?b=0:b++;this.highlightPos=b;var n=this;this._runId=setTimeout(function(){n._run.call(n)},Math.floor(h/l))},setPercent:function(a){this.percentDiv.innerHTML=a}};m.prototype={show:function(){var d=this._style,c=null;this._isGlobalBlockTarget()?(a.blockUI(d),c=a("body").children(".blockUI."+d.blockMsgClass+".blockPage")):(c=a(this.target),c.block(d),c=c.children(".blockUI."+d.blockMsgClass+".blockElement"));this.throbber.show(c.children(".indicator-throbber")[0]);
this._setPositionAndResizeWidth();return this},_setPositionAndResizeWidth:function(){var d=this._style,c=null,b=null,e=0;this._isGlobalBlockTarget()?(c=a("body"),b=c.children(".blockUI."+d.blockMsgClass+".blockPage"),b.css("top",(a(window).height()-b.outerHeight())/2+"px")):(c=a(this.target),b=c.children(".blockUI."+d.blockMsgClass+".blockElement"),b.css("top",(c.height()-b.outerHeight())/2+"px"));d=b.innerWidth()-b.width();b.children().each(function(){e=e+a(this).outerWidth(true)});b.width(e+d);
b.css("left",(c.width()-b.outerWidth())/2+"px")},_isGlobalBlockTarget:function(){return this.target===document||this.target===window||this.target===document.body},hide:function(){this._isGlobalBlockTarget()?a.unblockUI():a(this.target).unblock();return this},percent:function(a){"number"===typeof a&&0<=a&&100>=a&&this.throbber.setPercent(a);return this},message:function(d){if("string"===typeof d){var c=this._style,b=null,b=this._isGlobalBlockTarget()?a("body").children(".blockUI."+c.blockMsgClass+
".blockPage"):a(this.target).children(".blockUI."+c.blockMsgClass+".blockElement");b.children(".indicator-message").css("display","inline-block").text(d);this._setPositionAndResizeWidth()}return this}};h.u.obj.expose("h5.ui",{indicator:function(a,c){return new m(a,c)},isInView:function(c,e){var b,g,f,l,k=a(c);if(void 0===e)g=h.env.ua.isiOS?window.innerHeight:a(window).height(),l=h.env.ua.isiOS?window.innerWidth:a(window).width(),b=a(window).scrollTop(),f=a(window).scrollLeft();else{l=a(e);if(0===
l.find(k).length)return;b=l.offset().top+parseInt(l.css("border-top-width"));f=l.offset().left+parseInt(l.css("border-left-width"));g=l.innerHeight();l=l.innerWidth()}g=b+g;l=f+l;var m=k.offset().top,o=k.offset().left,n=m+k.outerHeight(),k=o+k.outerWidth();return(b<=m&&m<g||b<n&&n<=g)&&(f<=o&&o<l||f<k&&k<=l)},scrollToTop:function(){function c(){1===window.scrollY&&(e=0);0<e&&(window.scrollTo(0,1),e--,setTimeout(c,b))}var e=3,b=500;window.scrollTo(0,1);1!==a(window).scrollTop&&setTimeout(c,b)}})})();
(function(){function n(){var e=a.mobile.activePage;if(e){var e=e.attr("id"),g=c[e];if(k[e]&&(!g||0===g.length))o.addCSS(e),o.bindController(e)}}M({12E3:"JQMControllerはdisposeできません。",12001:"JQMControllerはunbindできません。"});h.log.createLogger("h5.ui.jqm.manager");var o=null,k={},c={},m={},r={},s=!1;h.u.obj.ns("h5.ui.jqm");h.ui.jqm.dataPrefix="h5";var u={__name:"JQMController",__construct:function(){this.dispose=function(){e(12E3)};this.unbind=function(){e(12001)}},__ready:function(){var c=this;a(':jqmData(role="page"), :jqmData(role="dialog")').each(function(){c.loadScript(this.id)})},
':jqmData(role="page"), :jqmData(role="dialog") pageinit':function(a){a=a.event.target.id;this.loadScript(a);this.addCSS(a);this.bindController(a)},"{document} pageremove":function(a){var a=a.event.target.id,e=c[a];if(e){for(var h=0,f=e.length;h<f;h++)e[h].dispose();c[a]=[]}},"{document} pagebeforeshow":function(a){a=a.event.target.id;this.addCSS(a);for(var e in c)for(var h=c[e],f=a===e,d=0,k=h.length;d<k;d++){var b=h[d];f?b.enableListeners():b.disableListeners()}},"{document} pagehide":function(a){this.removeCSS(a.event.target.id)},
"{rootElement} h5controllerbound":function(a){if(this!==a.evArg){var e=a.event.target.id;c[e]||(c[e]=[]);c[e].push(a.evArg)}},loadScript:function(c){var c=a("#"+c),e=a.trim(c.data(this.getDataAttribute("script")));if(0!==e.length)return e=a.map(e.split(","),function(c){return a.trim(c)}),c=!0==c.data(this.getDataAttribute("async")),h.u.loadScript(e,{async:c})},getDataAttribute:function(a){var c=h.ui.jqm.dataPrefix;null==c&&(c="h5");return 0!==c.length?c+"-"+a:a},bindController:function(a){var e=c[a];
k[a]&&!(e&&0<e.length)&&h.core.controller("#"+a,k[a],m[a])},addCSS:function(c){var e=r[c];if(e)for(var h=document.getElementsByTagName("head")[0],f=h.getElementsByTagName("link"),d=f.length,e=w(e),k=0,e=e.length;k<e;k++){for(var b=a.mobile.path.parseUrl(r[c][k]).filename,i=!1,m=0;m<d;m++)if(a.mobile.path.parseUrl(f[m].href).filename===b){i=!0;break}i||(b=document.createElement("link"),b.type="text/css",b.rel="stylesheet",b.href=r[c][k],h.appendChild(b))}},removeCSS:function(c){if(c=r[c]){var e=a.mobile.activePage.attr("id"),
e=r[e],h=w(c),f=w(e);a("link").filter(function(){var c=a(this).attr("href");return-1!==a.inArray(c,h)&&-1===a.inArray(c,f)}).remove()}}};h.u.obj.expose("h5.ui.jqm.manager",{init:function(){s||(s=!0,a(function(){o=ha.controllerInternal("body",u,null,{managed:!1});n()}))},define:function(c,e,h,f){k[c]=h;m[c]=f;r[c]=w(e);a.mobile.activePage&&a.mobile.activePage.attr("id")===c&&o?n():this.init()}})})();(function(){function n(){c||(c=navigator.geolocation);return c}function o(a,c){this.oblateness=a;this.semiMajorAxis=
c}function k(){}M({2E3:"正しい緯度または経度を指定して下さい。",2001:"正しい計算モード定数を指定して下さい",2002:"位置情報の取得に失敗しました。"});var c=null,m=h.env.ua;o.prototype.getOblateness=function(){return this.oblateness};o.prototype.getSemiMajorAxis=function(){return this.semiMajorAxis};var r=new o(298.257222,6378137),s=new o(299.152813,6377397.155),u=Math.PI/180;a.extend(k.prototype,{isSupported:m.isIE&&9<=m.browserVersion?!0:!!n(),getCurrentPosition:function(a){var c=h.async.deferred();n().getCurrentPosition(function(a){c.resolve(a)},function(a){c.reject(N(2002,
null,a))},a);return c.promise()},watchPosition:function(a){function c(){}var e=h.async.deferred(),f=n().watchPosition(function(a){e.notify(a)},function(a){e.reject(N(2002,null,a))},a);c.prototype.unwatch=function(){n().clearWatch(f);e.resolve()};return e.promise(new c)},getDistance:function(a,c,h,f,d){if(!isFinite(a)||!isFinite(c)||!isFinite(h)||!isFinite(f))throw new e(2E3);var k=d?d:r;if(!(k instanceof o))throw new e(2001);var d=k.getSemiMajorAxis(),b=k.getOblateness(),a=a*u,c=c*u,h=h*u,k=f*u,f=
(a+h)/2,b=Math.sqrt(2*b-1)/b,b=Math.pow(b,2),i=Math.sqrt(1-b*Math.pow(Math.sin(f),2)),b=d*(1-b)/Math.pow(i,3),d=d/i,c=c-k;return Math.sqrt(Math.pow(b*(a-h),2)+Math.pow(d*Math.cos(f)*c,2))},GS_GRS80:r,GS_BESSEL:s});h.u.obj.expose("h5.api",{geo:new k})})();(function(){function n(a){if(!a.DATABASE_ERR)return"データベースエラー";switch(a.code){case a.CONSTRAINT_ERR:return"一意制約に反しています。";case a.DATABASE_ERR:return"データベースエラー";case a.QUOTA_ERR:return"空き容量が不足しています。";case a.SYNTAX_ERR:return"構文に誤りがあります。";case a.TIMEOUT_ERR:return"ロック要求がタイムアウトしました。";
case a.TOO_LARGE_ERR:return"取得結果の行が多すぎます。";case a.UNKNOWN_ERR:return"トランザクション内で例外がスローされました。";case a.VERSION_ERR:return"データベースのバージョンが一致しません。"}}function o(a,b){for(var c=a._tasks,d=c.length-1;0<=d;d--){var e=c[d],f=n(b);e.deferred.reject(N(J,[f,b.message],b))}}function k(a){for(var a=a._tasks,b=a.length-1;0<=b;b--){var c=a[b];c.deferred.resolve(c.result)}}function c(a){if(a)throw new e(y);}function m(a,b){if("string"!==typeof b)throw new e(p,a);}function r(a,b){if(void 0!=b&&!(b instanceof l))throw new e(A,
a);}function s(b,c,d){if(a.isPlainObject(b))for(var f in b){var g=a.trim(f).replace(/ +/g," ").split(" "),h=[];if(""===g[0])throw new e(I);if(1===g.length)h.push(g[0]),h.push("="),h.push("?");else if(/^(<=|<|>=|>|=|!=|like)$/i.test(g[1]))3===g.length&&/^like$/i.test(g[1])?(h.push(g[0]),h.push(g[1]),h.push("?"),h.push("ESCAPE"),h.push('"'+g[2]+'"')):(h.push(g[0]),h.push(g[1]),h.push("?"));else throw new e(z);c.push(h.join(" "));d.push(b[f])}}function u(){}function l(a,b){this._db=a;this._tx=b;this._tasks=
[]}function g(b,c,d,e,f){c=h.u.str.format(D,d,c);a.isPlainObject(e)?(d=[],s(e,d,b),c+=" WHERE "+d.join(" AND ")):"string"===typeof e&&(c+=" WHERE "+e);a.isArray(f)&&(c+=" ORDER BY "+f.join(", "));return c}function F(b,c,d){this._txw=b;this._tableName=c;this._columns=a.isArray(d)?d.join(", "):"*";this._statement=this._orderBy=this._where=null;this._params=[];this._df=H();this._executed=!1}function f(a,b,c){this._txw=a;this._tableName=b;this._values=c?w(c):[];this._statement=[];this._params=[];this._df=
H();this._executed=!1}function d(a,b,c){this._txw=a;this._tableName=b;this._value=c;this._statement=this._where=null;this._params=[];this._df=H();this._executed=!1}function q(a,b){this._txw=a;this._tableName=b;this._statement=this._where=null;this._params=[];this._df=H();this._executed=!1}function b(a,b,c){this._txw=a;this._statement=b;this._params=c||[];this._df=H();this._executed=!1}function i(a){this._txw=a;this._queue=[];this._df=H();this._executed=!1}function v(a){this._db=a}function t(){}var D=
"SELECT {0} FROM {1}",y=3E3,p=3001,A=3002,z=3003,J=3010,I=3011,G={};G[y]="同一オブジェクトによるSQLの再実行はできません。";G[p]="{0}: テーブル名を指定して下さい。";G[A]="{0}: トランザクションが不正です。";G[z]="オペレータが不正です。 <= < >= > = != like のいずれかを使用して下さい。";G[3004]="{0}: {1}に指定したオブジェクトの型が不正です。";G[3005]="{0}: カラム名を指定して下さい。";G[3006]="{0}: 値を指定して下さい。";G[3007]="{0}: ステートメントが不正です。";G[3008]="{0}: パラメータは配列で指定して下さい。";G[3009]="指定されたオブジェクトはトランザクションに追加できません。Insert/Update/Del/Select/Sqlクラスのインスタンスを指定して下さい。";G[J]="トランザクション処理中にエラーが発生しました。{0} {1}";G[I]="where句に指定されたカラム名が空白または空文字です。";
M(G);h.log.createLogger("h5.api.sqldb");var H=h.async.deferred;a.extend(l.prototype,{_runTransaction:function(){return null!=this._tx},_execute:function(a,b,c){this._runTransaction()?this._tx.executeSql(a,b,c):this._db.transaction(a,b,c)},_addTask:function(a){this._tasks.push({deferred:a,result:null})},_setResult:function(a){this._tasks[this._tasks.length-1].result=a}});F.prototype=new u;a.extend(F.prototype,{where:function(b){if(!a.isPlainObject(b)&&"string"!==typeof b)throw new e(3004,["Select",
"where"]);this._where=b;return this},orderBy:function(b){if(!a.isPlainObject(b)&&"string"!==typeof b)throw new e(3004,["Select","orderBy"]);this._orderBy=w(b);return this},execute:function(){var a=this,b=H(),d=this._txw,e=this._executed,f=null;try{d._addTask(b),c(e),a._statement=g(a._params,a._tableName,a._columns,a._where,a._orderBy),d._runTransaction()?d._execute(this._statement,this._params,function(a,c){f=c.rows;d._setResult(f);b.notify(f,d)}):d._execute(function(c){d._tx=c;c.executeSql(a._statement,
a._params,function(a,c){f=c.rows;d._setResult(f);b.notify(f,d)})},function(a){o(d,a)},function(){k(d)})}catch(h){b.reject(h)}this._executed=!0;return b.promise()}});f.prototype=new u;a.extend(f.prototype,{execute:function(){function b(){d._statement.length===n?(l=m,g._setResult(l),f.notify(l,g)):g._execute(d._statement[n],d._params[n],function(a,c){n++;m.push(c.insertId);b()})}var d=this,e=function(){var b=d._values;if(0===b.length)d._statement.push(h.u.str.format("INSERT INTO {0} DEFAULT VALUES",
d._tableName)),d._params.push([]);else for(var c=0,e=b.length;c<e;c++){var f=b[c];if(null==f)d._statement.push(h.u.str.format("INSERT INTO {0} DEFAULT VALUES",d._tableName)),d._params.push([]);else if(a.isPlainObject(f)){var g=[],j=[],i=[],k;for(k in f)g.push("?"),j.push(k),i.push(f[k]);d._statement.push(h.u.str.format("INSERT INTO {0} ({1}) VALUES ({2})",d._tableName,j.join(", "),g.join(", ")));d._params.push(i)}}},f=H(),g=this._txw,i=this._executed,l=null,m=[],n=0;try{g._addTask(f),c(i),e(),g._runTransaction()?
b():g._execute(function(a){g._tx=a;b()},function(a){o(g,a)},function(){k(g)})}catch(p){f.reject(p)}this._executed=!0;return f.promise()}});d.prototype=new u;a.extend(d.prototype,{where:function(b){if(!a.isPlainObject(b)&&"string"!==typeof b)throw new e(3004,["Update","where"]);this._where=b;return this},execute:function(){var b=this,d=function(){var c=b._where,d=b._value,e=[],f;for(f in d)e.push(f+" = ?"),b._params.push(d[f]);b._statement=h.u.str.format("UPDATE {0} SET {1}",b._tableName,e.join(", "));
a.isPlainObject(c)?(d=[],s(c,d,b._params),b._statement+=" WHERE "+d.join(" AND ")):"string"===typeof c&&(b._statement+=" WHERE "+c)},e=H(),f=this._txw,g=this._executed,i=null;try{f._addTask(e),c(g),d(),f._runTransaction()?f._execute(this._statement,this._params,function(a,b){i=b.rowsAffected;f._setResult(i);e.notify(i,f)}):f._execute(function(a){f._tx=a;a.executeSql(b._statement,b._params,function(a,b){i=b.rowsAffected;f._setResult(i);e.notify(i,f)})},function(a){o(f,a)},function(){k(f)})}catch(l){e.reject(l)}this._executed=
!0;return e.promise()}});q.prototype=new u;a.extend(q.prototype,{where:function(b){if(!a.isPlainObject(b)&&"string"!==typeof b)throw new e(3004,["Del","where"]);this._where=b;return this},execute:function(){var b=this,d=function(){var c=b._where;b._statement=h.u.str.format("DELETE FROM {0}",b._tableName);if(a.isPlainObject(c)){var d=[];s(c,d,b._params);b._statement+=" WHERE "+d.join(" AND ")}else"string"===typeof c&&(b._statement+=" WHERE "+c)},e=H(),f=this._txw,g=this._executed,i=null;try{f._addTask(e),
c(g),d(),f._runTransaction()?f._execute(this._statement,this._params,function(b,a){i=a.rowsAffected;f._setResult(i);e.notify(i,f)}):f._execute(function(a){f._tx=a;a.executeSql(b._statement,b._params,function(a,b){i=b.rowsAffected;f._setResult(i);e.notify(i,f)})},function(a){o(f,a)},function(){k(f)})}catch(l){e.reject(l)}this._executed=!0;return e.promise()}});b.prototype=new u;a.extend(b.prototype,{execute:function(){var a=H(),b=this._txw,d=this._executed,e=this._statement,f=this._params,g=null;try{b._addTask(a),
c(d),b._runTransaction()?b._execute(e,f,function(c,d){g=d;b._setResult(g);a.notify(g,b)}):b._execute(function(c){b._tx=c;c.executeSql(e,f,function(c,d){g=d;b._setResult(g);a.notify(g,b)})},function(a){o(b,a)},function(){k(b)})}catch(h){a.reject(h)}this._executed=!0;return a.promise()}});i.prototype=new u;a.extend(i.prototype,{add:function(a){if(!(a instanceof u))throw new e(3009);this._queue.push(a);return this},execute:function(){function a(b){function c(a){this._txw=new l(null,a)}for(var d=[],e=
0,g=f.length;e<g;e++)c.prototype=f[e],d.push(new c(b));return d}function b(){if(i.length===h){for(var a=[],c=0,f=i.length;c<f;c++)a.push(i[c]._txw._tasks[0].result);e._setResult(a);d.notify(a,e)}else i[h].execute().progress(function(){h++;b()})}var d=this._df,e=this._txw,f=this._queue,g=this._executed,h=0,i=null;try{e._addTask(d),c(g),e._runTransaction()?(i=a(e._tx),b()):e._execute(function(c){i=a(c);e._tx=c;b()},function(a){o(e,a)},function(){k(e)})}catch(m){d.reject(m)}this._df=H();this._executed=
!0;return d.promise()},promise:function(){return this._df.promise()}});a.extend(v.prototype,{select:function(b,c,d){m("select",b);r("select",d);if(!a.isArray(c)&&"*"!==c)throw new e(3005,"select");return new F(d?d:new l(this._db,null),b,c)},insert:function(b,c,d){m("insert",b);r("insert",d);if(null!=c&&!a.isArray(c)&&!a.isPlainObject(c))throw new e(3006,"insert");return new f(d?d:new l(this._db,null),b,c)},update:function(b,c,f){m("update",b);r("update",f);if(!a.isPlainObject(c))throw new e(3006,
"update");return new d(f?f:new l(this._db,null),b,c)},del:function(b,a){m("del",b);r("del",a);return new q(a?a:new l(this._db,null),b)},sql:function(c,d,f){r("sql",f);if("string"!==typeof c)throw new e(3007,"sql");if(null!=d&&!a.isArray(d))throw new e(3008,"sql");return new b(f?f:new l(this._db,null),c,d)},transaction:function(a){r("sql",a);return new i(a?a:new l(this._db,null))}});a.extend(t.prototype,{isSupported:!!window.openDatabase,open:function(a,b,c,d){if(this.isSupported)return a=openDatabase(a,
b,c,d),new v(a)}});h.u.obj.expose("h5.api",{sqldb:new t})})();(function(){function e(a){this._storage=a}a.extend(e.prototype,{getLength:function(){return this._storage.length},key:function(a){return this._storage.key(a)},getItem:function(a){a=this._storage.getItem(a);return null===a?null:h.u.obj.deserialize(a)},setItem:function(a,e){this._storage.setItem(a,h.u.obj.serialize(e))},removeItem:function(a){this._storage.removeItem(a)},clear:function(){this._storage.clear()},each:function(a){for(var e=
this._storage,c=0,h=e.length;c<h;c++){var n=e.key(c);a(c,n,this.getItem(n))}}});h.u.obj.expose("h5.api.storage",{isSupported:!!window.localStorage,local:new e(window.localStorage),session:new e(window.sessionStorage)})})()})(jQuery);